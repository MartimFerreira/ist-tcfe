\section{Simulation Analysis}
\label{sec:simulation}

In this section, $ngspice$ results for the circuit shown above are presented. The AC-DC converter was simulated for 10 periods and the default model was used for the diodes.

Since this laboratory assignment consisted of an optimization problem, to start off we used a more elementary model and after verifying it was working properly, modifications were made in order to improve the quality of the circuit. In this particular case, that meant having the smallest output voltage ripple and the smallest cost possible. Also we wanted to have an output voltage average as close as possible to  $12 V$.




\subsection{Average output voltage level}
First and foremost, the average output voltage level was determined using ngspice's $mean()$ function. The average was calculated for over 1000 points.
%confirmar isto

The value obtained here for average output voltage is $12.00007 \ V$,
which has a deviation of the ideal $12 V$ of about $5.83*10^{-4} \ \%$, which is indeed quite small.
%maybe refer number of significant diits




\subsection{Output voltage ripple}
Using Ngspice's $MIN$ and $MAX$ functions, the minimum and maximum values of the output voltage were obtained. Their values are, respectively, $11.98591 \ V$ and $12.01317 \ V$. The output voltage ripple, which is the difference between the two previous values, was then calculated. It had a value of $0.02726 \ V$, which is almost zero, as intended.


This means that the output voltage signal, despite being sinusoidal, has a magnitude of almost $12 V$ and a ripple that is approximately null, therefore it is a pretty good approximation of a DC output voltage signal with a magnitude of $12 V$.




\subsection{Output voltages for the Envelope Detector and Voltage Regulator circuits}
In the graph below are the plots of the output voltages for the Envelope Detector and the Voltage Regulator circuits as a function of time.

\begin{figure}[H] \centering
\includegraphics[width=0.6\linewidth]{../sim/trans_regulator.pdf}
\caption{Output voltage for Envelope Detector (v(mid1), in red) and Voltage Regulator (v(out1), in blue)}
\label{fig:phase_sim}
\end{figure}


One can see that both voltages evolve sinusoidally over time, though this is more notorious for $v(mid1)$, since it has a larger amplitude. They have the same frequency and are in phase, as expected.

From $v(mid1)$ to $v(out1)$ there is a clear reduction of the signal's amplitude ($v(out1)$ has such a small amplitude that it appears to be constant over time) as well as the value around which it oscillates ($v(out1)$ is centered around the $12 \ V$ we aimed at), which is a consequence of the voltage regulator's function.
The fact that $v(mid1)$ is so much above $v(out1)$ has to do with the fact that the resistor between both has a high value to reduce the ripple value.




\subsection{Output AC component and DC deviation}
Finally, there is the plot of $v_o - 12$, where $v_o$ is the circuit's output voltage.

\begin{figure}[H] \centering
\includegraphics[width=0.6\linewidth]{../sim/trans_centered_output.pdf}
\caption{Difference (im mV) between the Output Voltage and the desired 12V}
\label{fig:phase_sim}
\end{figure}

In this graphic we can verify that the output voltage ripple is indeed quite small (the units are in $mV$) and that it oscillates similarly to the previous voltages.




\subsection{Merit figure calculation}
Given all the above-mentioned points, it is now possible to calculate the merit figure, which is in the table below.
%develop further??

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|c|}
    \hline    
    {\bf Name} & {\bf ngspice Values} & {\bf Theoretically Predicted Values} \\ \hline
    \input{merit_tab.tex}
  \end{tabular}
  \caption{Values determined as part of the merit calculation procedure.}
  \label{tab:merit}
\end{table}

