\newpage
\section{Simulation Analysis}
\label{sec:simulation}

In this section, ngspice simulation results for the circuit shown above are presented.

\subsection{Gain Response with Frequency}

An AC analysis of the circuit was performed in order to figure out how the gain and phase of the circuit varied with frequency. The resulting graphs can be seen in figures \ref{fig:gain_freq} and \ref{fig:phase_freq}.


\begin{figure}[H]
\centering
\begin{minipage}[H]{0.45\linewidth}
{\includegraphics[width=1.1\columnwidth]{../sim/vo1f.pdf}}
\caption{Circuit gain variation with frequency (in dB)}
\label{fig:gain_freq}
\end{minipage}
\quad
\begin{minipage}[H]{0.45\linewidth}
\includegraphics[width=1.1\columnwidth]{../sim/vo1p.pdf}
\vspace{-4pt}
\caption{Circuit phase variation with frequency (in degrees)}
\label{fig:phase_freq}
\end{minipage}
\end{figure}


%\begin{figure}[H] \centering
%\includegraphics[width=0.6\linewidth]{../sim/vo1f.pdf}
%\includegraphics[height=8cm]{../sim/vo1f.pdf}
%\caption{Circuit gain variation with frequency (in dB)}
%\label{fig:gain_freq}
%\end{figure}

%\begin{figure}[H] \centering
%\includegraphics[width=0.6\linewidth]{../sim/vo1p.pdf}
%\caption{Circuit phase variation with frequency (in degrees)}
%\label{fig:phase_freq}
%\end{figure}

This type of analysis allows us to determine the maximum gain of the circuit and its cutoff frequencies, with which we can calculate the central frequency ($f_{central}$) of the passband filter. These values, together with the cost of the circuit, can also be used to calculate the merit figure. In order to perform these measurements, the ngspice functions ``MAX'' and ``WHEN'' were used.

\begin{table}[H]
  \centering
  \begin{tabular}{|c|c|}
    \hline
      \input{../sim/op_tab.tex}
  \end{tabular}
  \caption{Values obtained: $f_{central}$ (centralfreq) is in Hz, the gain at $f = 1 kHz$ (centralgain) is in linear units and the input impedance, which has real and imaginary parts, is in $k\Omega$}
  \label{tab:resultssim}
\end{table}

A separate analysis was run, with a different script, in order to determine the circuit's output impedance. In this script, the input voltage source was set to have 0 amplitude and at the end of the circuit a 1V amplitude test voltage source was placed. The output impedance obtained was $Z_o = (0.45 - 0.15j) k\Omega$.





